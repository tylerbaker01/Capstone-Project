---
title: "Capstone Project"
author: "Tyler Baker"
date: '2022-10-01'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
library(psych)
```

# Capstone Project
### Tyler Baker

## Objective
The objective of this project is to use non-sports related data to predict World Cup winners.

## Variables
The variables are as follows:
GDP
Literacy Rate
Population
Cereal Yield
Rural Population %
Urban Population %
Mortality Rate for Children <5
Government Expenditure on Education

## Data
Most of the data comes from the World Bank and one set comes from Kaggle.

### World Bank Data
```{r}
cereal_yield_raw <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/Cereal_Yield.csv")
gdp_raw <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/GDP.csv")
gov_exp_raw <-read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/Gov_Expendeture_Education.csv")
literacy_rate_raw <-read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/Literacy_Rate.csv")
mortality_rate_raw <-read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/MortalityRate_Kids_Under5.csv")
population_raw <-read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/Population.csv")
rural_pop_raw <-read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/Rural_Population_Percentage.csv")
urban_pop_raw <-read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/Urban_Population_Percentage.csv")
teen_fertility_rate <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/Adolecent Fertility Rate.csv")
life_expectancy <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/Life Expectancy at Birth.csv")
farm_land_percentage<- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/Percentage of Farm Land.csv")
```

### World Cup Data
```{r}
world_cup_1930 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1930.csv")
world_cup_1934 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1934.csv")
world_cup_1938 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1938.csv")
world_cup_1950 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1950.csv")
world_cup_1954 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1954.csv")
world_cup_1958 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1958.csv")
world_cup_1962 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1962.csv")
world_cup_1966 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1966.csv")
world_cup_1970 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1970.csv")
world_cup_1974 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1974.csv")
world_cup_1978 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1978.csv")
world_cup_1982 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1982.csv")
world_cup_1986 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1986.csv")
world_cup_1990 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1990.csv")
world_cup_1994 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1994.csv")
world_cup_1998 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 1998.csv")
world_cup_2002 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 2002.csv")
world_cup_2006 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 2006.csv")
world_cup_2010 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 2010.csv")
world_cup_2014 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 2014.csv")
world_cup_2018 <- read.csv("https://raw.githubusercontent.com/tylerbaker01/Capstone-Project/main/FIFA - 2018.csv")
```

## Data Tidying

### Part 1
I need to first combine all of the world cup data into one data set. I can do this by adding a year column to each dataset and then only keeping the position, the nation, and the year of the world cup. I will also want to remove the given goal difference column and make a new one, becasue the negative values did not get loaded properly. I will also want to make a composite score. The composite score will be $composite score = (33 - soccer.rank) + (goal.differential/100) + (goals.scored/1000)$ To begin I wanted to switch the order around of the soccer ranks. I am using 33 because after the 1994 World Cup, the format switched to 32 teams. This is because it will be easier to read graphs, and it will play the biggest factor in my composite score. The goal differential is just there to separate all of the teams that share a rank. We need a hierarchy for each rank. Finally, I added goals scored to be split teams that might have the same rank, and goal differential.


```{r}
world_cup_1930$year <- c("1930")
world_cup_1934$year <- c("1934")
world_cup_1938$year <- c("1938")
world_cup_1950$year <- c("1950")
world_cup_1954$year <- c("1954")
world_cup_1958$year <- c("1958")
world_cup_1962$year <- c("1962")
world_cup_1966$year <- c("1966")
world_cup_1970$year <- c("1970")
world_cup_1974$year <- c("1974")
world_cup_1978$year <- c("1978")
world_cup_1982$year <- c("1982")
world_cup_1986$year <- c("1986")
world_cup_1990$year <- c("1990")
world_cup_1994$year <- c("1994")
world_cup_1998$year <- c("1998")
world_cup_2002$year <- c("2002")
world_cup_2006$year <- c("2006")
world_cup_2010$year <- c("2010")
world_cup_2014$year <- c("2014")
world_cup_2018$year <- c("2018")
```

```{r}
wc_data <- rbind(world_cup_1930, world_cup_1934, world_cup_1938, world_cup_1950, world_cup_1954, world_cup_1958, world_cup_1962, world_cup_1966, world_cup_1970, world_cup_1974, world_cup_1978, world_cup_1982, world_cup_1986, world_cup_1990, world_cup_1994, world_cup_1998, world_cup_2002, world_cup_2006, world_cup_2010, world_cup_2014, world_cup_2018)
wc_data <- wc_data[c("Position","Team", "Goals.For","Goals.Against", "year")]
colnames(wc_data)<- c("standing","team","goals_for","goals_against","year")
```

I also want to update the countries. For example West Germany should just be considered as Germany. Soviet Union should just be considered as Russia. Czechoslovakia will just be the Czech Republic. Dutch East Indies will be India. FR Yugoslavia will be Yugoslavia. China PR will be China.
```{r}
wc_data$team[wc_data$team=="West Germany"]<-"Germany"
wc_data$team[wc_data$team=="Soviet Union"]<-"Russia"
wc_data$team[wc_data$team=="Czechoslovakia"]<-"Czech Republic"
wc_data$team[wc_data$team=="Dutch East Indies"]<-"India"
wc_data$team[wc_data$team=="FR Yugoslavia"]<-"Yugoslavia"
wc_data$team[wc_data$team=="China PR"]<- "China"
wc_data$team[wc_data$team=="Turkey"]<-"Turkiye"
wc_data$team[wc_data$team=="Serbia and Montenegro"]<-"Serbia"
wc_data$team[wc_data$team=="Republic of Ireland"]<-"Ireland"
```

```{r}
wc_data$goal_diff<- wc_data$goals_for - wc_data$goals_against
wc_data$composite_score <- (33-wc_data$standing)+(wc_data$goal_diff/100)+(wc_data$goals_for/1000)
```
### Part 2
I also need to combine all of the world bank data. This can be done by first pivoting each dataframe longer. Once they are pivoted longer, I can row bind them all together. I will then have to decide what to do with the NAs. I will do this by using the midpoint formula to estimate the data.

```{r}
cereal_yield <- cereal_yield_raw
colnames(cereal_yield)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
cereal_yield <- cereal_yield[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
cereal_yield<- cereal_yield %>%
  pivot_longer(!country, names_to = "year", values_to = "cereal_yield")
```

```{r}
gdp<-gdp_raw
colnames(gdp)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
gdp <- gdp[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
gdp<- gdp %>%
  pivot_longer(!country, names_to = "year", values_to = "gdp")
```

```{r}
gov_exp<-gov_exp_raw
colnames(gov_exp)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
gov_exp <- gov_exp[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
gov_exp<- gov_exp %>%
  pivot_longer(!country, names_to = "year", values_to = "gov_exp_on_edu")
```

```{r}
lit_rate<-literacy_rate_raw
colnames(lit_rate)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
lit_rate <- lit_rate[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
lit_rate<- lit_rate %>%
  pivot_longer(!country, names_to = "year", values_to = "lit_rate")
```

```{r}
mortality_rate<-mortality_rate_raw
colnames(mortality_rate)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
mortality_rate <- mortality_rate[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
mortality_rate<- mortality_rate %>%
  pivot_longer(!country, names_to = "year", values_to = "mortality_rate")
```

```{r}
pop<-population_raw
colnames(pop)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
pop <- pop[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
pop<- pop %>%
  pivot_longer(!country, names_to = "year", values_to = "population")
```

```{r}
rural<-rural_pop_raw
colnames(rural)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
rural <- rural[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
rural<- rural %>%
  pivot_longer(!country, names_to = "year", values_to = "rural_pop_percentage")
```

```{r}
urban<-urban_pop_raw
colnames(urban)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
urban <- urban[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
urban<- urban %>%
  pivot_longer(!country, names_to = "year", values_to = "urban_pop_percentage")
```

```{r}
colnames(farm_land_percentage)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
farm_land_percentage <- farm_land_percentage[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
farm_land_percentage<- farm_land_percentage %>%
  pivot_longer(!country, names_to = "year", values_to = "farm_land_percentage")
```

```{r}
colnames(life_expectancy)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
life_expectancy <- life_expectancy[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
life_expectancy<- life_expectancy %>%
  pivot_longer(!country, names_to = "year", values_to = "life_expectancy")
```

```{r}
colnames(teen_fertility_rate)<- c("country","country_code", "indicator","indicator_code","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")
teen_fertility_rate <- teen_fertility_rate[c("country","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020")]
teen_fertility_rate <- teen_fertility_rate %>%
  pivot_longer(!country, names_to = "year", values_to = "teen_fertility_rate")
```


```{r}
country_metrics <- merge(cereal_yield,gdp, by=c("country","year"))
country_metrics <- merge(country_metrics,gov_exp, by=c("country","year"))
country_metrics <- merge(country_metrics,lit_rate, by=c("country","year"))
country_metrics <- merge(country_metrics,mortality_rate, by=c("country","year"))
country_metrics <- merge(country_metrics,pop, by=c("country","year"))
country_metrics <- merge(country_metrics,rural, by=c("country","year"))
country_metrics <- merge(country_metrics,urban, by=c("country","year"))
country_metrics <- merge(country_metrics, farm_land_percentage, by=c("country","year"))
country_metrics <- merge(country_metrics, teen_fertility_rate, by=c("country","year"))
country_metrics <- merge(country_metrics, life_expectancy, by=c("country","year"))
```

### Part 3
Finally, I need to combine the world cup data with the country metrics.

```{r}
wc_data <- wc_data[c("standing","team","year","composite_score")]
colnames(wc_data) <- c("soccer_rank", "country",  "year", "team_score")
data<- merge(country_metrics,wc_data, by=c("country","year"))
```

### Part 4
Now I need to decide what to do  about the NAs in the dataset. There are a lot.
```{r}
sum(is.na(data$cereal_yield))
sum(is.na(data$gdp))
sum(is.na(data$gov_exp_on_edu))
sum(is.na(data$lit_rate))
sum(is.na(data$mortality_rate))
sum(is.na(data$population))
sum(is.na(data$rural_pop_percentage))
sum(is.na(data$urban_pop_percentage))
```
We see that the two education columns are just full of NAs. Almost every observation of literacy rate is an NA. There is nothing I can do with these because there really isn't data so I will just drop them.

```{r}
data <- data[c("country","year","cereal_yield","gdp","mortality_rate","population","rural_pop_percentage","urban_pop_percentage","farm_land_percentage","teen_fertility_rate","life_expectancy","soccer_rank","team_score")]
df<- na.omit(data)
```

I now must create some metrics that can span time. I will make a cereal yield per population variable, and a gdp per population variable.
```{r}
df$cereal_yield_per_pop <- df$cereal_yield/df$population
df$gdp_per_population <- df$gdp/df$population
```

I also want to account for gdp difference between the years. I will do this by taking each highest gdp per person from each of the 4 years and then divide that number by 4 to make a low gdp per person, a lower middle gdp per person, an upper middle gdp per person, and a high gdp per person. I will do this by splitting the dataframe into every year first, then doing the math.
```{r}
df_1962 <- df %>%
  filter(year=="1962") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_1966 <- df %>%
  filter(year=="1966") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_1970 <- df %>%
  filter(year=="1970") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_1974 <- df %>%
  filter(year=="1974") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_1978 <- df %>%
  filter(year=="1978") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp_per_population)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_1982 <- df %>%
  filter(year=="1982") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_1986 <- df %>%
  filter(year=="1986") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_1990 <- df %>%
  filter(year=="1990") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_1994 <- df %>%
  filter(year=="1994") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_1998 <- df %>%
  filter(year=="1998") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_2002 <- df %>%
  filter(year=="2002") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_2006 <- df %>%
  filter(year=="2006") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_2010 <- df %>%
  filter(year=="2010") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_2014 <- df %>%
  filter(year=="2014") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df_2018 <- df %>%
  filter(year=="2018") %>%
  mutate(gdp_class = 
           case_when(gdp < (max(gdp)/4) ~ "low",
                     gdp >= (max(gdp)/4) & gdp < (max(gdp)/2) ~ "low_middle",
                     gdp >= (max(gdp)/2) & gdp < (max(gdp)*(.75)) ~ "upper_middle",
                     gdp >= (max(gdp)*(.75)) & gdp <= (max(gdp)) ~ "high")
         )
```

```{r}
df<- rbind(df_1962, df_1966, df_1970, df_1974, df_1978, df_1982, df_1986, df_1990, df_1994, df_1998, df_2002, df_2006, df_2010, df_2014, df_2018)
```

```{r}
df <- df %>%
  mutate(gdp_extreme =
           case_when(
             endsWith(gdp_class, "le") ~ "not exteme",
             endsWith(gdp_class, "ow") ~ "extreme",
             endsWith(gdp_class, "gh") ~ "extreme"
           ))
```

Now that the data is ready I can move on to regression.

## Regression

Before I am able to do any of the real regression, I must first split this dataframe into a training group and a testing group.
```{r}
set.seed(12121)
dt = sort(sample(nrow(df), nrow(data)*.7))
train <- df[dt,]
test <- df[-dt,]
```

Now I want to save the soccer composite score as a separate vector and remove it from the test dataframe.
```{r}
real_soccer_ranks <- test$soccer_rank
test<- test[c("country","year","cereal_yield","gdp","mortality_rate","population","rural_pop_percentage","urban_pop_percentage","farm_land_percentage","teen_fertility_rate","life_expectancy","cereal_yield_per_pop","gdp_per_population","gdp_class","gdp_extreme")]
```

Okay. Now I can begin to visual the data.
```{r}
pairs(train[,3:15])
```
Well, it's hard to tell if there seems to be any relationships between team_score and any of the other variables. There might be something for population, cereal_yield, life_expectancy, and mortality_rate. I would like to take the log of the all of the fraction variables. This should always provide a better outlook.


```{r}
x <- log(train$mortality_rate)
plot(x, train$team_score)
```
Okay, from the graph there doesn't appear to be any significant pattern. On to the next one.

```{r}
x <- log(train$rural_pop_percentage)
plot(x, train$team_score)
```

Again, I do not see any patterns. Onto the next.

```{r}
x <- log(train$urban_pop_percentage)
plot(x, train$team_score)
```
Okay there might be a relationship here. Maybe not a strong one, but it does appear that the higher the urban population the higher the soccer score. 

```{r}
x <- log(train$farm_land_percentage)
plot(x, train$team_score)
```
There might be something here. It's kind of hard to tell.

```{r}
x <- log(train$teen_fertility_rate)
plot(x, train$team_score)
```
There might be something here as well, but it would be pretty slight.

```{r}
x <- log(train$cereal_yield_per_pop)
plot(x, train$team_score)
```
This looks like maybe the less cereal_yield_per people the better the soccer team does.

```{r}
x <- log(train$gdp_per_population)
plot(x, train$team_score)
```
I do not really see anything here.

Now I will graph all of them without a log function.
```{r}
plot(train$cereal_yield, train$team_score)
```
It appears that there could be a relationship between cereal_yield and team_score. The more cereal, the higher the team score.

```{r}
plot(train$gdp, train$team_score)
```

Alright, there definetly seems to be a relationship here. The countries with a higher gdp seem to not do as well in soccer.

```{r}
plot(train$mortality_rate, train$team_score)
```
There seems to be a slight relationship here that shows that the higher the mortality rate, the better the soccer team is.

```{r}
plot(train$population, train$team_score)
```
It seems to show that the countries with more people are not as good at soccer. This is not surprising. Asian countries are not usually know for soccer prowess.

```{r}
plot(train$rural_pop_percentage, train$team_score)
```
There seems to maybe be a negative relationship here.

```{r}
plot(train$urban_pop_percentage, train$team_score)
```
There seems to a postive linear relationship here.

```{r}
plot(train$farm_land_percentage, train$team_score)
```
I do not really see any pattern here.

```{r}
plot(train$teen_fertility_rate, train$team_score)
```
I do not really see anything here either.

```{r}
plot(train$life_expectancy, train$team_score)
```
There might be a slight relationship here.

```{r}
plot(train$cereal_yield_per_pop, train$team_score)
```
This line is too vertical to determine if there is any relationship at all.
There seems to be one outlier, which is Nigeria

```{r}
plot(train$gdp_per_population, train$team_score)
```
There might be a small relationship here.

Okay. Now I will create a model by first using every variable, then I will drop off variables one by one based on there significance.

The first model well be taken at the same value. The second will take the log of each percentage variable.

#### Model 1
```{r}
model_1 <- lm(team_score ~ cereal_yield_per_pop + gdp_per_population  + mortality_rate + population + urban_pop_percentage + gdp + cereal_yield+ farm_land_percentage + teen_fertility_rate + life_expectancy + gdp_class +gdp_extreme, data=train)
summary(model_1)
```

Again, I only want to worry about the variables that have significance. Therefore, I will ignore gdp_class, teen_fertility_rate, gdp_extreme, and farm_land_percentage.

```{r}
model_1 <- lm(team_score ~ cereal_yield_per_pop + gdp_per_population  + mortality_rate + population + urban_pop_percentage + gdp + cereal_yield + life_expectancy, data=train)
summary(model_1)
```

```{r}
model_2 <- lm(team_score ~ cereal_yield + gdp + log(mortality_rate) + population + log(rural_pop_percentage) + log(urban_pop_percentage) + log(farm_land_percentage) + log(teen_fertility_rate) + life_expectancy + log(cereal_yield_per_pop) + log(gdp_per_population) + gdp_class + gdp_extreme, data=train)
summary(model_2)
```
Well, it already seems like the first model is the better of the two. Now I will do some regression analysis.

## Regression Analysis

First I will look at the summary plots of the model. This will help me to determine if there are any problems with my residuals.

```{r}
plot(model_1)
```
The residuals vs fitted plot shows me that the residuals are nearly normal. They are pretty evenly spread around both sides of zero. There appears to be no pattern. This is good.

The QQ plot shows that most of the residuals do fall along the diagonal line. There seems to be maybe be one residual on the right end that pulls the data away from the line. This is probably due to some outlier within the data. I do not believe that it warrants any worry because most of the residuals do fit the line. This means that our data is most likely normalized. The outlier could simply just seem like an outlier because we do not have an enormous data set. We only have data from 1962 to 2018 by every four years. As time continues we very well could find future observations that naturally fit in between the majority of our data and the outlier.

The scale-location plot is an interesting one. First, the red line is not the most horizontal, however it is horizontal around where the majority of the residuals are. Second, there are no patterns within our residuals. Again, this could be a result of having a realitivly small sample size.

The residuals vs leverage plot shows us that observation 261 is right near the red dash line. This means it's very close to being an influential point. This must be that outlier that has been popping up in the other diagnostic plots. The outlier is the 2018 Iceland team. Since it has not passed the line, I will leave it. The rest of the observations fit well.

The diagnostic plots show that I can trust the multiple linear regression model. Now we can interpret the summary statistics.

```{r}
summary(model_1)
```

The R squared shows that the regression model is able to account for about 21% of the variability observed in the target variable.
The residual standard error shows that we expect there to be an error of about 8 for every observation. This means that we should probably look for a better model in order to predict the soccer ranks. Right now we would predict a countries soccer rank give or take 8 spots. On one hand, that's a large difference for a tournament of 32 teams. On the other hand, maybe that's okay for sports predictions.

## Improving the model

## Predictions

Now I will use my model to predict the outcomes of my test group. I will first guess the team_score and then I will subtract the floor from 33 to get the team ranks. Then I will calculate my accuracy.

```{r}
predicted_score<- predict(model_1, test)
```

```{r}
accuracy_df <- data.frame(predicted_score)
accuracy_df$predicted_score[accuracy_df$predicted_score > 33] <- 32
accuracy_df$predicted_rank <- 33 - floor(accuracy_df$predicted_score)
accuracy_df$real_rank <- real_soccer_ranks
```

I am running into an error with one of the predictions. I am getting a prediction score of over 80, which doesn't really make sense. I would like to just drop it down to a 32.



